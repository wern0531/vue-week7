import{P as O,M as y}from"./Pagination-0c376250.js";import{_ as x,r as w,o as d,c as o,d as t,F as _,f as u,b as M,t as l,C as P,D as g,I as f,J as C}from"./index-962eb06a.js";const{VITE_APP_URL:p,VITE_APP_PATH:m}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"wern",BASE_URL:"/vue-week7/",MODE:"production",DEV:!1,PROD:!0};let k="",b="";const D={data(){return{orders:[],page:{},tempOrder:{}}},methods:{createDate(a){return new Date(a*1e3).toLocaleDateString()},currency(a){return`${parseInt(a,10).toFixed(0).replace(/./g,(c,h,s)=>h&&c!=="."&&(s.length-h)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},getOrders(a=1){this.$http.get(`${p}v2/api/${m}/admin/orders?page=${a}`).then(n=>{console.log(n),this.orders=n.data.orders,this.page=n.data.pagination,console.log(this.orders)})},updatePaid(a){const n={is_paid:a.is_paid};this.$http.put(`${p}v2/api/${m}/admin/order/${a.id}`,{data:n}).then(c=>{console.log(c)})},openModel(a,n){a==="edit"?(this.tempOrder={...n},k.show()):a==="del"&&(this.tempOrder={...n},b.show())},delOrder(){this.$http.delete(`${p}v2/api/${m}/admin/order/${this.tempOrder.id}`).then(a=>{this.tempOrder={},this.getOrders(),b.hide(),alert(a.data.message)})}},components:{Pagination:O},mounted(){this.getOrders(),k=new y(this.$refs.orderModal,{keyboard:!1}),b=new y(this.$refs.delOrderModal,{keyboard:!1})}},V={class:"container"},E={class:"table mt-4"},L=t("thead",null,[t("tr",null,[t("th",{width:"120"},"購買時間"),t("th",{width:"120"},"Email"),t("th",{width:"200"},"購買款項"),t("th",{width:"120"},"應付金額"),t("th",{width:"100"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),A={class:""},T={class:"list-unstyled"},I={class:""},S={class:"form-check form-switch"},U=["onUpdate:modelValue","onChange"],B={class:"form-check-label",for:"flexSwitchCheckDefault"},N={key:0,class:"text-success"},R={key:1},F={class:"btn-group"},q=["onClick"],H=["onClick"],j={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},J={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},G=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-md-4"},X=t("h3",null,"用戶資料",-1),Y={class:"table"},Z={key:0},$=t("th",{style:{width:"100px"}},"姓名",-1),tt=t("th",null,"Email",-1),et=t("th",null,"電話",-1),st=t("th",null,"地址",-1),lt={class:"col-md-8"},dt=t("h3",null,"訂單細節",-1),ot={class:"table"},nt=t("th",{style:{width:"100px"}},"訂單編號",-1),at=t("th",null,"下單時間",-1),it=t("th",null,"付款時間",-1),rt={key:0},ct={key:1},_t=t("th",null,"付款狀態",-1),ht={key:0,class:"text-success"},ut={key:1,class:"text-muted"},pt=t("th",null,"總金額",-1),mt=t("h3",null,"選購商品",-1),bt={class:"table"},yt=t("thead",null,[t("tr")],-1),gt={class:"text-end"},ft={class:"d-flex justify-content-end"},kt={class:"form-check"},vt={class:"form-check-label",for:"flexCheckDefault"},Ot={key:0},xt={key:1},wt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"button",class:"btn btn-primary"},"修改付款狀態")],-1),Mt={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Pt={class:"modal-dialog"},Ct={class:"modal-content border-0"},Dt=C('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除產品</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong> 商品(刪除後將無法恢復)。 </div>',2),Vt={class:"modal-footer"},Et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Lt(a,n,c,h,s,i){const v=w("Pagination");return d(),o(_,null,[t("div",V,[t("table",E,[L,t("tbody",null,[(d(!0),o(_,null,u(s.orders,e=>(d(),o("tr",{key:e.id},[t("td",null,l(i.createDate(e.create_at)),1),t("td",null,l(e.user.email),1),t("td",A,[t("ul",T,[(d(!0),o(_,null,u(e.products,r=>(d(),o("li",{key:r.id},l(r.product.title)+" 數量 : "+l(r.qty)+l(r.product.unit),1))),128))])]),t("td",I,l(e.total),1),t("td",null,[t("div",S,[g(t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault","onUpdate:modelValue":r=>e.is_paid=r,onChange:r=>i.updatePaid(e)},null,40,U),[[f,e.is_paid]]),t("label",B,[e.is_paid===!0?(d(),o("span",N,"已付款")):(d(),o("span",R,"未付款"))])])]),t("td",null,[t("div",F,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>i.openModel("edit",e)}," 檢視 ",8,q),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>i.openModel("del",e)}," 刪除 ",8,H)])])]))),128))])]),M(v,{pages:s.page,"get-products-data":i.getOrders},null,8,["pages","get-products-data"])]),t("div",j,[t("div",J,[t("div",z,[G,t("div",K,[t("div",Q,[t("div",W,[X,t("table",Y,[s.tempOrder.user?(d(),o("tbody",Z,[t("tr",null,[$,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[tt,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[et,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[st,t("td",null,l(s.tempOrder.user.address),1)])])):P("",!0)])]),t("div",lt,[dt,t("table",ot,[t("tbody",null,[t("tr",null,[nt,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[at,t("td",null,l(i.createDate(s.tempOrder.create_at)),1)]),t("tr",null,[it,t("td",null,[s.tempOrder.paid_date?(d(),o("span",rt,l(i.createDate(s.tempOrder.paid_date)),1)):(d(),o("span",ct,"時間不正確"))])]),t("tr",null,[_t,t("td",null,[s.tempOrder.is_paid?(d(),o("strong",ht,"已付款")):(d(),o("span",ut,"尚未付款"))])]),t("tr",null,[pt,t("td",null,l(i.currency(s.tempOrder.total)),1)])])]),mt,t("table",bt,[yt,t("tbody",null,[(d(!0),o(_,null,u(s.tempOrder.products,e=>(d(),o("tr",{key:e.id},[t("th",null,l(e.product.title),1),t("td",null,l(e.qty)+" / "+l(e.product.unit),1),t("td",gt,l(i.currency(e.final_total)),1)]))),128))])]),t("div",ft,[t("div",kt,[g(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=e=>s.tempOrder.is_paid=e)},null,512),[[f,s.tempOrder.is_paid]]),t("label",vt,[s.tempOrder.is_paid?(d(),o("span",Ot,"已付款")):(d(),o("span",xt,"未付款"))])])])])])]),wt])])],512),t("div",Mt,[t("div",Pt,[t("div",Ct,[Dt,t("div",Vt,[Et,t("button",{type:"button",class:"btn btn-danger",onClick:n[1]||(n[1]=(...e)=>i.delOrder&&i.delOrder(...e))}," 確認刪除 ")])])])],512)],64)}const It=x(D,[["render",Lt]]);export{It as default};
